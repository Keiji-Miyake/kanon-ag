# Kanon Agent Development Guidelines

**Kanon** におけるエージェントの開発と、エージェント間の連携に関するガイドラインです。

## 🎭 エージェントの役割 (Roles)

Kanon では、以下の役割（ロール）を持つエージェントを定義し、それぞれに特化したプロンプトと権限を付与します。

### 1. **Project Manager (PM) / Conductor (指揮者)**
- 開発要件からタスクを分解し、担当エージェントへ割り当てます。
- プロジェクト全体の進捗管理と、エージェント間の「合意」を調整します。

### 2. **Programmer (プログラマー)**
- 設計（スペック）に基づき、高品質なコードを実装します。
- 既存コードベースの変更や新機能の追加を担当します。

### 3. **Tester (テスター)**
- プログラマーが作成したコードを自動検証（テスト・レビュー）します。
- テスト結果から不具合を特定し、修正のためのフィードバックをプログラマーへ返します。

### 4. **Operator / Devops (オペレーター)**
- 外部ツール（Git, CI/CD, デプロイツール）との連携を担当します。

## 💬 エージェント間通信 (Communication)

エージェント同士は、**Message Bus (メッセージバス)** を介して情報をやり取りします。

- **メッセージの構造**:
  - `sender`: 送信エージェント ID
  - `receiver`: 受信エージェント ID（またはブロードキャスト）
  - `task_id`: 紐づくタスクの ID
  - `payload`: 作業内容、エラー報告、レビュー結果などの具体的な情報

- **修正ループ (Healing Loop)**:
  1. `Programmer` が実装完了を報告。
  2. `Tester` が自動テストを実行し、エラー（不具合）を検出。
  3. `Tester` が `Programmer` へ修正要求（ログを含む）をメッセージで送信。
  4. `Programmer` が修正し、再度報告。

## ⚠️ 開発の重要事項

- **文脈（Context）の共有**:
  - 各エージェントは常に「現在のプロジェクトの全体像（Docs/ARCH.md等）」を把握している必要があります。
- **冪等性 (Idempotency)**:
  - エージェントによる操作（ファイルの書き換え等）は、何度実行しても期待される最終状態になるように設計してください。
- **外部ツールへの制御権**:
  - 権限が過剰にならないよう、最小権限の原則 (PoLP) を適用します。

---
(C) 2026 Kanon Project / Keiji Miyake
